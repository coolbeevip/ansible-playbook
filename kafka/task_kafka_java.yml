# 上传安装包
- name: check upload java
  stat:
    path: /opt/jdk-8u202-linux-x64.tar.gz
  register: check_result
- name: upload java
  synchronize:
    src: /ansible-playbook/packages/jdk-8u202-linux-x64.tar.gz
    dest: /opt/jdk-8u202-linux-x64.tar.gz
  when: not check_result.stat.exists
  check_mode: no

# 安装 java
- name: check unzip java
  stat:
    path: /opt/jdk1.8.0_202
  register: check_result
- name: unzip java
  shell: |
    cd /opt
    tar zxf jdk-8u202-linux-x64.tar.gz
  when: not check_result.stat.exists
  check_mode: no

# 配置环境
- name: check java profile config
  shell: cat /etc/profile | grep JAVA_HOME=/opt/jdk1.8.0_202
  register: check_result
  check_mode: no
- name: java profile config
  shell: echo {{ item }} >> /etc/profile && source /etc/profile
  with_items:
    - export JAVA_HOME=/opt/jdk1.8.0_202
    - export JRE_HOME=/opt/jdk1.8.0_202/jre
    - export CLASSPATH=.:\$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:\$JRE_HOME/lib:\$CLASSPATH
    - export PATH=\$JAVA_HOME/bin:\$PATH
  when: check_result.stdout == ""
  check_mode: no
