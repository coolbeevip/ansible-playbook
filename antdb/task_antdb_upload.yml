- name: include vars
  include_vars: "vars_antdb.yml"

# 上传 mysql 安装包
- name: check upload antdb
  stat:
    path: "{{ antdb_soft_src_dir }}/{{ antdb_tar }}"
  register: check_result
  check_mode: no
- name: upload antdb
  synchronize:
    src: "/ansible-playbook/packages/{{ antdb_tar }}"
    dest: "{{ antdb_soft_src_dir }}/{{ antdb_tar }}"
  check_mode: no
  when: not check_result.stat.exists

# Install rpm package
- name: Check install rpm package
  stat:
    path: "$ADB_HOME/bin"
  register: check_result
  check_mode: no
- name: Install rpm package
  shell: rpm -ivh {{ antdb_soft_src_dir }}/{{ antdb_tar }} --relocate=/opt/app/antdb=$ADB_HOME
  check_mode: no
  become: yes
  when: not check_result.stat.exists
- name: Change rpm file permission
  file:
    path: $ADB_HOME
    owner: "{{ antdb_user }}"
    group: "{{ antdb_group }}"
    recurse: true
    state: directory
    mode: "2755"
  check_mode: no
  become: yes
