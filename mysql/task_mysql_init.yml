- name: include vars
  include_vars: "vars_mysql.yml"

# 初始化 mysql 数据
- name: check initialize mysql
  stat:
    path: "{{ mysql_data_dir }}/mysql"
  register: check_result
  check_mode: no
- name: initialize mysql
  shell: "source ~/.bash_profile && {{ mysql_home_dir }}/{{ mysql_tar_unzip_dir }}/bin/mysqld --initialize --user=mysql && {{ mysql_home_dir }}/{{ mysql_tar_unzip_dir }}/bin/mysql_ssl_rsa_setup"
  check_mode: no
  when: not check_result.stat.exists

# 安装 mysql 服务
- name: check install mysql service
  stat:
    path: "/etc/init.d/mysql.server"
  register: check_result
  check_mode: no
- name: install mysql service
  shell: "cp {{ mysql_home_dir }}/{{ mysql_tar_unzip_dir }}/support-files/mysql.server /etc/init.d/mysql.server"
  check_mode: no
  become: yes
  when: not check_result.stat.exists

# # 启动 mysql
# - name: check start mysql
#   shell: ps -ef | {{ mysql_home_dir }}/{{ mysql_tar_unzip_dir }}/bin/mysqld | wc -l
#   register: check_result
#   check_mode: no
# - name: start mysql
#   shell: "source ~/.bash_profile && {{ mysql_home_dir }}/{{ mysql_tar_unzip_dir }}/bin/mysqld_safe --user=mysql &"
#   check_mode: no
#   when: check_result.stdout|int > 0
